apiVersion: batch/v1
kind: Job
metadata:
  name: lldap-bootstrap
  namespace: auth
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: bootstrap
        image: nitnelave/lldap:2025-04-25-alpine
        command:
        - /app/bootstrap.sh
        env:
        - name: LLDAP_URL
          value: "http://lldap:8080"
        - name: LLDAP_ADMIN_USERNAME
          value: "admin"
        - name: LLDAP_ADMIN_PASSWORD
          valueFrom:
            secretKeyRef:
              name: lldap-secrets
              key: ldap-user-pass
        - name: DO_CLEANUP
          value: "true"
        volumeMounts:
        - name: user-configs
          mountPath: /bootstrap/user-configs
          readOnly: true
        - name: group-configs
          mountPath: /bootstrap/group-configs
          readOnly: true
      volumes:
      - name: user-configs
        projected:
          sources:
          - secret:
            name: lldap-admin-user
            items:
            - key: user-config.json
              path: admin-config.json
          - secret:
            name: lldap-password-manager-user
            items:
            - key: user-config.json
              path: password-manager-config.json
          - secret:
            name: lldap-bootstrap-configs
            items:
            - key: user-configs.json
              path: user-configs.json
      - name: group-configs
        projected:
          sources:
          - secret:
            name: lldap-bootstrap-configs
            items:
            - key: group-configs.json
              path: group-configs.json
